<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Admin Panel - ClickWorx</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="../style.css">
  <style>
    :root {
      --red: #e50914;
      --red-dark: #b00610;
      --bg-dark: #0d0d0d;
      --bg-card: #1a1a1a;
      --text-light: #fff;
      --highlight: #00bcd4;
    }
    body {
      font-family: Arial, sans-serif;
      background: var(--bg-dark);
      color: var(--text-light);
      padding: 0;
      margin: 0;
    }
    .page-offset { margin-top: 80px; }
    h1 { text-align: center; color: var(--red); margin-bottom: 20px; }
    .flex-row { display: flex; gap: 15px; flex-wrap: wrap; padding: 15px; }
    .section {
      background: var(--bg-card);
      padding: 15px;
      border-radius: 8px;
      border: 1px solid var(--red);
      flex: 1;
      min-width: 320px;
      margin-bottom: 15px;
    }
    h2 { margin: 0 0 10px; color: var(--red); font-size: 18px; }
    label { display: block; margin-top: 8px; font-size: 14px; }
    input, select, textarea {
      width: 100%; margin-top: 5px; padding: 6px;
      border-radius: 6px; border: none; outline: none;
    }
    textarea { min-height: 70px; resize: vertical; }
    .inline { display: flex; align-items: center; gap: 10px; margin-top: 8px; flex-wrap: wrap; }
    button {
      margin-top: 10px; padding: 6px 12px;
      background: var(--red); border: none; border-radius: 6px;
      color: #fff; cursor: pointer; font-size: 14px;
    }
    button:hover { background: var(--red-dark); }
    .preview { margin-top: 8px; max-width: 80%; border-radius: 6px; }
    table { width: 100%; border-collapse: collapse; margin-top: 15px; font-size: 14px; }
    th, td { padding: 6px; border: 1px solid #333; text-align: left; }
    th { background: #222; }
    td img { max-width: 60px; border-radius: 4px; }
    #loginOverlay {
      position: fixed; inset: 0; background: rgba(0,0,0,0.9);
      display: flex; align-items: center; justify-content: center;
      z-index: 10000;
    }
    #loginBox {
      background: var(--bg-card);
      padding: 20px;
      border-radius: 10px;
      border: 1px solid var(--red);
      width: 300px;
      text-align: center;
    }
    #loginBox h2 { margin-bottom: 15px; }
    #carImagePreview img { max-width: 120px; margin: 5px; border-radius: 4px; }
    .export-buttons { display: flex; flex-wrap: wrap; gap: 10px; }
  </style>
</head>
<body>

  <!-- Header -->
  <header class="header">
    <div class="container">
      <a href="../index.html" class="logo">CLICK<span>WORX</span></a>
      <nav class="navbar" id="navbar">
        <ul>
          <li><a href="../index.html">Home</a></li>
          <li><a href="urgent.html">Urgent Sale</a></li>
          <li><a href="more.html">More Cars</a></li>
          <li><a href="search.html">Search</a></li>
          <li><a href="about.html">About</a></li>
          <li><a href="contact.html">Contact</a></li>
          <li><a href="admin.html" class="active">Admin</a></li>
        </ul>
        <div class="menu-toggle" id="menu-toggle">&#9776;</div>
      </nav>
    </div>
  </header>
  <div class="page-offset"></div>

  <!-- Hero Slideshow (visual only in admin) -->
  <section class="hero-section">
    <div class="hero-slider" id="heroSlider"></div>
    <div class="overlay"></div>
  </section>

  <!-- Login -->
  <div id="loginOverlay">
    <div id="loginBox">
      <h2>Admin Login</h2>
      <input type="password" id="loginPassword" placeholder="Enter Password">
      <button onclick="checkLogin()">Login</button>
      <hr style="margin:15px 0;border:0;border-top:1px solid #333;">
      <h3 style="color:var(--red);font-size:16px;">Set New Password</h3>
      <input type="password" id="newPassword" placeholder="New Password">
      <button onclick="setPassword()">Save Password</button>
    </div>
  </div>

  <h1>Admin Panel</h1>

  <div class="flex-row">

    <!-- Car Management -->
    <div class="section">
      <h2>Add / Manage Cars</h2>
      <label>Category</label>
      <select id="carCategory"><option value="urgent">Urgent Sale</option><option value="more">More Cars</option></select>
      <label>Car Name</label><input type="text" id="carName">
      <label>Model</label><input type="text" id="carModel">
      <label>Specs</label><input type="text" id="carSpecs">
      <label>Color</label><input type="text" id="carColor">
      <label>Mileage</label><input type="text" id="carMileage">
      <label>Mulkia</label><input type="text" id="carMilkiya">
      <label>Accident History</label><input type="text" id="carAccident">
      <label>Location</label><input type="text" id="carLocation" placeholder="City or Area">
      <label>Price & Negotiable</label>
      <div class="inline">
        <input type="text" id="carPrice" placeholder="e.g. $25,000" style="width:60%;">
        <label><input type="checkbox" id="carNegotiable"> Negotiable</label>
      </div>
      <label>Ribbon</label><input type="text" id="carRibbon">
      <label>Details</label><textarea id="carDetails"></textarea>
      <label>Car Image URLs (comma separated)</label><textarea id="carImageUrls"></textarea>
      <div id="carImagePreview"></div>
      <div class="inline">
        <button onclick="addCar()">Add Car</button>
        <button onclick="syncCars()">Sync Cars</button>
        <button onclick="resetForm()">Reset</button>
      </div>
    </div>

    <!-- Banner Management -->
    <div class="section">
      <h2>Manage Banners (left, right, horizontal)</h2>
      <label>Left Banner</label>
      <input type="file" id="leftBanner" accept="image/*" onchange="previewBanner('leftBanner','left')">
      <img id="left" class="preview" style="display:none;">
      <label>Right Banner</label>
      <input type="file" id="rightBanner" accept="image/*" onchange="previewBanner('rightBanner','right')">
      <img id="right" class="preview" style="display:none;">
      <label>Horizontal Banner</label>
      <input type="file" id="horizontalBanner" accept="image/*" onchange="previewBanner('horizontalBanner','horizontal')">
      <img id="horizontal" class="preview" style="display:none;">
      <div style="margin-top:10px">
        <button onclick="saveAllBannersAndHero()">Save Banners & Hero</button>
      </div>
      <table id="bannerTable"><thead><tr><th>Type</th><th>Preview</th></tr></thead><tbody></tbody></table>
    </div>

    <!-- Hero Slideshow -->
    <div class="section">
      <h2>Hero Slideshow (uses same banners.json keys hero1..hero4)</h2>
      <label>Hero Image 1</label><input type="file" id="hero1" accept="image/*" onchange="previewHero('hero1','hero1Preview')">
      <img id="hero1Preview" class="preview" style="display:none;">
      <label>Hero Image 2</label><input type="file" id="hero2" accept="image/*" onchange="previewHero('hero2','hero2Preview')">
      <img id="hero2Preview" class="preview" style="display:none;">
      <label>Hero Image 3</label><input type="file" id="hero3" accept="image/*" onchange="previewHero('hero3','hero3Preview')">
      <img id="hero3Preview" class="preview" style="display:none;">
      <label>Hero Image 4</label><input type="file" id="hero4" accept="image/*" onchange="previewHero('hero4','hero4Preview')">
      <img id="hero4Preview" class="preview" style="display:none;">
      <div style="margin-top:10px">
        <button onclick="saveAllBannersAndHero()">Save Hero & Banners</button>
      </div>
      <table id="heroTable"><thead><tr><th>#</th><th>Preview</th></tr></thead><tbody></tbody></table>
    </div>

    <!-- WhatsApp -->
    <div class="section">
      <h2>WhatsApp Settings</h2>
      <label>WhatsApp Number</label><input type="text" id="whatsappNumber" placeholder="923001234567">
      <button onclick="saveWhatsApp()">Save Number</button>
    </div>

    <!-- Export -->
    <div class="section">
      <h2>Export Data</h2>
      <div class="export-buttons">
        <button onclick="exportCars()">Export cars.json</button>
        <button onclick="exportBanners()">Export banners.json</button>
      </div>
    </div>
  </div>

  <div class="section" style="margin:15px;">
    <h2>Cars List</h2>
    <table id="carTable"><thead><tr><th>Images</th><th>Name</th><th>Model</th><th>Specs</th><th>Price</th><th>Actions</th></tr></thead><tbody></tbody></table>
  </div>

<script>
document.getElementById("menu-toggle").addEventListener("click",()=>{document.querySelector(".navbar ul").classList.toggle("show");});

let cars = JSON.parse(localStorage.getItem("cars")) || [];
// BANNERS object uses keys expected by other pages:
// left, right, horizontal, hero1, hero2, hero3, hero4
let banners = JSON.parse(localStorage.getItem("banners")) || {
  left: "", right: "", horizontal: "", hero1: "", hero2: "", hero3: "", hero4: ""
};
let storedPassword = localStorage.getItem("adminPassword") || "admin123";

/* --- Auth --- */
function checkLogin(){
  const p = document.getElementById("loginPassword").value;
  if (p === storedPassword) document.getElementById("loginOverlay").style.display="none";
  else alert("Wrong password!");
}
function setPassword(){
  const np = document.getElementById("newPassword").value;
  if (np.trim() !== "") {
    localStorage.setItem("adminPassword", np);
    storedPassword = np;
    alert("Password updated!");
  } else alert("Password cannot be empty.");
}

/* Cars */
let editIndex=-1;
function addCar(){
 const car={category:carCategory.value,name:carName.value,model:carModel.value,specs:carSpecs.value,
 color:carColor.value,mileage:carMileage.value,milkiya:carMilkiya.value,accident:carAccident.value,
 location:carLocation.value,price:carPrice.value,negotiable:carNegotiable.checked,ribbon:carRibbon.value,
 details:carDetails.value,images:carImageUrls.value.split(",").map(u=>u.trim()).filter(u=>u)};
 if(editIndex>=0){cars[editIndex]=car;editIndex=-1;alert("Car updated!");}
 else{cars.unshift(car);alert("Car added!");}
 localStorage.setItem("cars",JSON.stringify(cars));renderCarTable();resetForm();
}
function editCar(i){if(confirm("Edit this car?")){const c=cars[i];editIndex=i;
 carCategory.value=c.category;carName.value=c.name;carModel.value=c.model;carSpecs.value=c.specs;
 carColor.value=c.color;carMileage.value=c.mileage;carMilkiya.value=c.milkiya;
 carAccident.value=c.accident;carLocation.value=c.location||"";
 carPrice.value=c.price;carNegotiable.checked=c.negotiable;
 carRibbon.value=c.ribbon;carDetails.value=c.details;carImageUrls.value=c.images.join(", ");window.scrollTo(0,0);}
}
function confirmDelete(i){if(confirm("Delete this car?")){cars.splice(i,1);localStorage.setItem("cars",JSON.stringify(cars));renderCarTable();}}
function renderCarTable(){const tbody=document.querySelector("#carTable tbody");tbody.innerHTML="";
 cars.forEach((c,i)=>{const tr=document.createElement("tr");tr.innerHTML=`<td>${c.images.map(img=>`<img src="${img}">`).join(" ")}</td><td>${c.name}</td><td>${c.model}</td><td>${c.specs}</td><td>${c.location}</td><td>${c.price}</td><td><button onclick="editCar(${i})">Edit</button> <button onclick="confirmDelete(${i})">Delete</button></td>`;tbody.appendChild(tr);});
}
function resetForm(){document.querySelectorAll("#carName,#carModel,#carSpecs,#carColor,#carMileage,#carMilkiya,#carAccident,#carLocation,#carPrice,#carRibbon,#carDetails,#carImageUrls").forEach(e=>e.value="");carNegotiable.checked=false;}
function syncCars(){const blob=new Blob([JSON.stringify(cars,null,2)],{type:"application/json"});const a=document.createElement("a");a.href=URL.createObjectURL(blob);a.download="cars.json";a.click();URL.revokeObjectURL(a.href);alert("cars.json downloaded. Upload to /data/");}

/* --- Banner & Hero Preview helpers --- */
function previewBanner(inputId, key) {
  const f = document.getElementById(inputId).files[0];
  if (!f) return;
  const r = new FileReader();
  r.onload = e => {
    banners[key] = e.target.result; // inline base64
    document.getElementById(key).src = e.target.result;
    document.getElementById(key).style.display = "block";
    localStorage.setItem("banners", JSON.stringify(banners));
    renderBannerTable();
  };
  r.readAsDataURL(f);
}
function previewHero(inputId, previewId) {
  const f = document.getElementById(inputId).files[0];
  if (!f) return;
  const r = new FileReader();
  r.onload = e => {
    // preview element id is previewId (like hero1Preview), but we also store under banners.hero1
    const heroKey = inputId; // hero1, hero2...
    banners[heroKey] = e.target.result;
    document.getElementById(previewId).src = e.target.result;
    document.getElementById(previewId).style.display = "block";
    localStorage.setItem("banners", JSON.stringify(banners));
    renderHeroTable();
  };
  r.readAsDataURL(f);
}

/* --- Save everything (banners + hero) into single banners.json --- */
function saveAllBannersAndHero(){
  // If user selected files, they already triggered previewBanner/previewHero which updated banners and localStorage.
  // We just ensure current banners object is saved and exported as banners.json
  localStorage.setItem("banners", JSON.stringify(banners));
  renderBannerTable();
  renderHeroTable();

  // Export banners.json
  const data = JSON.stringify(banners, null, 2);
  const blob = new Blob([data], { type: "application/json" });
  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = "banners.json";
  a.click();
  URL.revokeObjectURL(a.href);

  alert("âœ… banners.json downloaded. Upload to /data/banners.json on GitHub Pages.");
}

/* Render tables from banners object */
function renderBannerTable(){
  const tbody = document.querySelector("#bannerTable tbody");
  tbody.innerHTML = "";
  const list = [["left","Left"],["right","Right"],["horizontal","Horizontal"]];
  list.forEach(([k,label])=>{
    if (banners[k]) {
      const tr = document.createElement("tr");
      tr.innerHTML = `<td>${label}</td><td><img src="${banners[k]}" class="preview"></td>`;
      tbody.appendChild(tr);
    }
  });
}
function renderHeroTable(){
  const tbody = document.querySelector("#heroTable tbody");
  tbody.innerHTML = "";
  ["hero1","hero2","hero3","hero4"].forEach((k, idx)=>{
    if (banners[k]) {
      const tr = document.createElement("tr");
      tr.innerHTML = `<td>${idx+1}</td><td><img src="${banners[k]}" class="preview"></td>`;
      tbody.appendChild(tr);
      // also set preview img in hero preview area if present
      const pid = k + "Preview";
      const el = document.getElementById(pid);
      if (el) { el.src = banners[k]; el.style.display = "block"; }
    }
  });
}

/* WhatsApp */
function saveWhatsApp(){ localStorage.setItem("whatsappNumber", whatsappNumber.value); alert("WhatsApp number saved!"); }

/* Exports */
function exportCars(){ const blob = new Blob([JSON.stringify(cars,null,2)], { type:"application/json" }); const a = document.createElement("a"); a.href = URL.createObjectURL(blob); a.download = "cars.json"; a.click(); URL.revokeObjectURL(a.href); }
function exportBanners(){ const blob = new Blob([JSON.stringify(banners,null,2)], { type:"application/json" }); const a = document.createElement("a"); a.href = URL.createObjectURL(blob); a.download = "banners.json"; a.click(); URL.revokeObjectURL(a.href); }

/* Init */
renderCarTable();
renderBannerTable();
renderHeroTable();
document.getElementById("whatsappNumber").value = localStorage.getItem("whatsappNumber") || "";
</script>
</body>
</html>
