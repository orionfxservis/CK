<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Admin Panel - ClickWorx</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    :root {
      --red: #e50914;
      --red-dark: #b00610;
      --bg-dark: #0d0d0d;
      --bg-card: #1a1a1a;
      --text-light: #fff;
    }
    body {
      font-family: Arial, sans-serif;
      background: var(--bg-dark);
      color: var(--text-light);
      padding: 15px;
    }
    h1 { width: 100%; font-size: 1.8rem; text-align: center; color: var(--red); margin-bottom: 15px; }
    .flex-row { display: flex; gap: 15px; flex-wrap: wrap; }
    .section {
      background: var(--bg-card);
      padding: 15px;
      border-radius: 8px;
	  margin-top: 10px;
      border: 1px solid var(--red);
      flex: 1;
      min-width: 320px;
    }
    h2 { margin: 0 0 10px; color: var(--red); font-size: 18px; }
    label { display: block; margin-top: 8px; font-size: 14px; }
    input, select, textarea {
      width: 100%; margin-top: 5px; padding: 6px;
      border-radius: 6px; border: none; outline: none;
    }
    textarea { min-height: 70px; resize: vertical; }
    .inline { display: flex; align-items: center; gap: 10px; margin-top: 8px; }
    button {
      margin-top: 10px; padding: 6px 12px;
      background: var(--red); border: none; border-radius: 6px;
      color: #fff; cursor: pointer; font-size: 14px;
    }
    button:hover { background: var(--red-dark); }
    .preview { margin-top: 8px; max-width: 100%; border-radius: 6px; }
    table { width: 100%; border-collapse: collapse; margin-top: 15px; font-size: 14px; }
    th, td { padding: 6px; border: 1px solid #333; text-align: left; }
    th { background: #222; }
    td img { max-width: 80px; border-radius: 4px; }
    tr.dragging { opacity: 0.5; background: #333; }

    .export-buttons { margin-top: 20px; display: flex; gap: 10px; }

    /* Responsive */
    @media (max-width: 768px) {
      .flex-row { flex-direction: column; }
      table { font-size: 12px; }
      th, td { padding: 4px; }
    }
  </style>
</head>
<body>

  <h1>Admin Panel</h1>

  <div class="flex-row">
    <!-- Car Management -->
    <div class="section">
      <h2>Add / Manage Cars</h2>
      <label>Category</label>
      <select id="carCategory">
        <option value="urgent">Urgent Sale</option>
        <option value="normal">Normal</option>
      </select>

      <label>Car Name</label><input type="text" id="carName">
      <label>Model</label><input type="text" id="carModel">
      <label>Specs</label><input type="text" id="carSpecs">
      <label>Color</label><input type="text" id="carColor">
      <label>Mileage</label><input type="text" id="carMileage">
      <label>Milkiya</label><input type="text" id="carMilkiya">
      <label>Accident History</label><input type="text" id="carAccident">

      <label>Price</label>
      <div class="inline">
        <input type="text" id="carPrice" placeholder="e.g. $25,000">
        <label><input type="checkbox" id="carNegotiable"> Negotiable</label>
      </div>

      <label>Ribbon (Editable)</label>
      <input type="text" id="carRibbon" placeholder="e.g. Hot Deal, Limited">

      <label>Details</label>
      <textarea id="carDetails" placeholder="Enter full car details..."></textarea>

      <label>Upload Car Images (Multiple)</label>
      <input type="file" id="carImages" accept="image/*" multiple>
      <div id="carImagePreview"></div>

      <button onclick="addCar()">Add Car</button>
    </div>

    <!-- Banner Management -->
    <div class="section">
      <h2>Manage Banners</h2>
      <label>Left Banner</label>
      <input type="file" id="leftBanner" accept="image/*">
      <img id="leftPreview" class="preview" style="display:none;" />

      <label>Right Banner</label>
      <input type="file" id="rightBanner" accept="image/*">
      <img id="rightPreview" class="preview" style="display:none;" />

      <label>Horizontal Banner</label>
      <input type="file" id="horizontalBanner" accept="image/*">
      <img id="horizontalPreview" class="preview" style="display:none;" />

      <button onclick="saveBanners()">Save Banners</button>

      <table id="bannerTable">
        <thead>
          <tr><th>Type</th><th>Preview</th><th>Actions</th></tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

    <!-- WhatsApp Settings -->
    <div class="section">
      <h2>WhatsApp Settings</h2>
      <label>WhatsApp Business Number (with country code)</label>
      <input type="text" id="whatsappNumber" placeholder="e.g. 923001234567">
      <button onclick="saveWhatsApp()">Save Number</button>
    </div>
  </div>

  <!-- Car Table -->
  <div class="section">
    <h2>Cars List (Drag to Reorder)</h2>
    <table id="carTable">
      <thead>
        <tr>
          <th>Image</th><th>Name</th><th>Model</th><th>Specs</th><th>Price</th><th>Actions</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <!-- Export JSON -->
  <div class="section">
    <h2>Export Data</h2>
    <div class="export-buttons">
      <button onclick="exportCars()">Export cars.json</button>
      <button onclick="exportBanners()">Export banners.json</button>
    </div>
  </div>

<script>
  let editIndex = null;
  const carImagesInput = document.getElementById("carImages");
  const carImagePreview = document.getElementById("carImagePreview");

  carImagesInput.addEventListener("change", () => {
    carImagePreview.innerHTML = "";
    [...carImagesInput.files].forEach(file => {
      const reader = new FileReader();
      reader.onload = e => {
        const img = document.createElement("img");
        img.src = e.target.result;
        img.style.maxWidth = "80px";
        img.style.margin = "5px";
        img.style.borderRadius = "4px";
        carImagePreview.appendChild(img);
      };
      reader.readAsDataURL(file);
    });
  });

  function loadCars() {
    const cars = JSON.parse(localStorage.getItem("cars")) || [];
    const tbody = document.querySelector("#carTable tbody");
    tbody.innerHTML = "";
    cars.forEach((car, i) => {
      const row = document.createElement("tr");
      row.draggable = true;
      row.innerHTML = `
        <td>${car.images?.length ? `<img src="${car.images[0]}">` : ""}</td>
        <td>${car.name}</td>
        <td>${car.model}</td>
        <td>${car.specs}</td>
        <td>${car.price} ${car.negotiable ? "(Negotiable)" : ""}</td>
        <td>
          <button onclick="editCar(${i})">Edit</button>
          <button onclick="deleteCar(${i})">Delete</button>
        </td>`;
      tbody.appendChild(row);
    });
    enableDragDrop();
  }

  async function addCar() {
    const cars = JSON.parse(localStorage.getItem("cars")) || [];
    const files = carImagesInput.files;

    const images = await Promise.all([...files].map(file => new Promise(res => {
      const reader = new FileReader();
      reader.onload = e => res(e.target.result);
      reader.readAsDataURL(file);
    })));

    const newCar = {
      category: carCategory.value,
      name: carName.value,
      model: carModel.value,
      specs: carSpecs.value,
      color: carColor.value,
      mileage: carMileage.value,
      milkiya: carMilkiya.value,
      accident: carAccident.value,
      price: carPrice.value,
      negotiable: carNegotiable.checked,
      ribbon: carRibbon.value,
      details: carDetails.value,
      images: images.length ? images : (editIndex !== null ? cars[editIndex].images : [])
    };

    if (editIndex !== null) {
      cars[editIndex] = newCar;
      editIndex = null;
    } else {
      cars.unshift(newCar);
    }

    localStorage.setItem("cars", JSON.stringify(cars));
    loadCars();
    resetForm();
  }

  function resetForm() {
    carName.value = carModel.value = carSpecs.value = carColor.value = "";
    carMileage.value = carMilkiya.value = carAccident.value = carPrice.value = "";
    carNegotiable.checked = false;
    carRibbon.value = carDetails.value = "";
    carImagesInput.value = "";
    carImagePreview.innerHTML = "";
  }

  function deleteCar(i) {
    const cars = JSON.parse(localStorage.getItem("cars")) || [];
    cars.splice(i, 1);
    localStorage.setItem("cars", JSON.stringify(cars));
    loadCars();
  }

  function editCar(i) {
    const cars = JSON.parse(localStorage.getItem("cars")) || [];
    const c = cars[i];
    carCategory.value = c.category;
    carName.value = c.name;
    carModel.value = c.model;
    carSpecs.value = c.specs;
    carColor.value = c.color;
    carMileage.value = c.mileage;
    carMilkiya.value = c.milkiya;
    carAccident.value = c.accident;
    carPrice.value = c.price;
    carNegotiable.checked = c.negotiable;
    carRibbon.value = c.ribbon;
    carDetails.value = c.details;
    editIndex = i;
  }

  function enableDragDrop() {
    const tbody = document.querySelector("#carTable tbody");
    let draggingRow;

    tbody.querySelectorAll("tr").forEach(row => {
      row.addEventListener("dragstart", e => {
        draggingRow = row;
        row.classList.add("dragging");
      });
      row.addEventListener("dragend", e => {
        row.classList.remove("dragging");
        saveOrder();
      });
    });

    tbody.addEventListener("dragover", e => {
      e.preventDefault();
      const afterElement = getDragAfterElement(tbody, e.clientY);
      if (afterElement == null) {
        tbody.appendChild(draggingRow);
      } else {
        tbody.insertBefore(draggingRow, afterElement);
      }
    });
  }

  function getDragAfterElement(container, y) {
    const draggableElements = [...container.querySelectorAll("tr:not(.dragging)")];
    return draggableElements.reduce((closest, child) => {
      const box = child.getBoundingClientRect();
      const offset = y - box.top - box.height / 2;
      if (offset < 0 && offset > closest.offset) {
        return { offset, element: child };
      } else {
        return closest;
      }
    }, { offset: Number.NEGATIVE_INFINITY }).element;
  }

  function saveOrder() {
    let cars = JSON.parse(localStorage.getItem("cars")) || [];
    const rows = document.querySelectorAll("#carTable tbody tr");
    const newOrder = [];

    rows.forEach(row => {
      const name = row.querySelector("td:nth-child(2)").textContent;
      const car = cars.find(c => c.name === name);
      if (car) newOrder.push(car);
    });

    localStorage.setItem("cars", JSON.stringify(newOrder));
    loadCars();
  }

  /* ---------------- Banner Management ---------------- */
  let banners = JSON.parse(localStorage.getItem("banners")) || {};

  function previewBanner(inputId, previewId, key) {
    const input = document.getElementById(inputId);
    const preview = document.getElementById(previewId);

    input.addEventListener("change", () => {
      const file = input.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = e => {
          preview.src = e.target.result;
          preview.style.display = "block";
        };
        reader.readAsDataURL(file);
      }
    });

    if (banners[key]) {
      preview.src = banners[key];
      preview.style.display = "block";
    }
  }

  previewBanner("leftBanner", "leftPreview", "left");
  previewBanner("rightBanner", "rightPreview", "right");
  previewBanner("horizontalBanner", "horizontalPreview", "horizontal");

  function saveBanners() {
    const left = document.getElementById("leftBanner").files[0];
    const right = document.getElementById("rightBanner").files[0];
    const horizontal = document.getElementById("horizontalBanner").files[0];

    function fileToBase64(file) {
      return new Promise(resolve => {
        const reader = new FileReader();
        reader.onload = e => resolve(e.target.result);
        reader.readAsDataURL(file);
      });
    }

    Promise.all([
      left ? fileToBase64(left) : banners.left,
      right ? fileToBase64(right) : banners.right,
      horizontal ? fileToBase64(horizontal) : banners.horizontal
    ]).then(([leftData, rightData, horizontalData]) => {
      banners = { left: leftData, right: rightData, horizontal: horizontalData };
      localStorage.setItem("banners", JSON.stringify(banners));
      renderBanners();
    });
  }

  function renderBanners() {
    const tbody = document.querySelector("#bannerTable tbody");
    tbody.innerHTML = "";
    for (const [key, src] of Object.entries(banners)) {
      if (!src) continue;
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${key}</td>
        <td><img src="${src}" style="max-width:100px;border-radius:4px"></td>
        <td><button onclick="deleteBanner('${key}')">Delete</button></td>
      `;
      tbody.appendChild(tr);
    }
  }

  function deleteBanner(type) {
    delete banners[type];
    localStorage.setItem("banners", JSON.stringify(banners));
    renderBanners();
    if (type === "left") document.getElementById("leftPreview").style.display = "none";
    if (type === "right") document.getElementById("rightPreview").style.display = "none";
    if (type === "horizontal") document.getElementById("horizontalPreview").style.display = "none";
  }

  /* ---------------- WhatsApp Settings ---------------- */
  function saveWhatsApp() {
    const number = document.getElementById("whatsappNumber").value.trim();
    if (!number) return alert("Please enter a WhatsApp number");
    localStorage.setItem("whatsappNumber", number);
    alert("WhatsApp number saved!");
  }

  /* ---------------- Export JSON ---------------- */
  function exportCars() {
    const cars = JSON.parse(localStorage.getItem("cars")) || [];
    const blob = new Blob([JSON.stringify(cars, null, 2)], {type:"application/json"});
    const url = URL.createObjectURL(blob);
    downloadFile(url, "cars.json");
  }

  function exportBanners() {
    const banners = JSON.parse(localStorage.getItem("banners")) || {};
    const blob = new Blob([JSON.stringify(banners, null, 2)], {type:"application/json"});
    const url = URL.createObjectURL(blob);
    downloadFile(url, "banners.json");
  }

  function downloadFile(url, filename) {
    const a = document.createElement("a");
    a.href = url;
    a.download = filename;
    a.click();
    URL.revokeObjectURL(url);
  }

  document.addEventListener("DOMContentLoaded", () => {
    loadCars();
    renderBanners();
    document.getElementById("whatsappNumber").value = localStorage.getItem("whatsappNumber") || "";
  });
</script>
</body>
</html>
