<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Admin Panel - ClickWorx</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    :root {
      --red: #e50914;
      --red-dark: #b00610;
      --bg-dark: #0d0d0d;
      --bg-card: #1a1a1a;
      --text-light: #fff;
    }
    body {
      font-family: Arial, sans-serif;
      background: var(--bg-dark);
      color: var(--text-light);
      padding: 15px;
    }
    h1 { width: 100%; font-size: 1.8rem; color: var(--red); margin-bottom: 15px; }
    .flex-row { display: flex; gap: 15px; flex-wrap: wrap; }
    .section {
      background: var(--bg-card);
      padding: 15px;
      border-radius: 8px;
      border: 1px solid var(--red);
      flex: 1;
      min-width: 320px;
    }
    h2 { margin: 0 0 10px; color: var(--red); font-size: 18px; }
    label { display: block; margin-top: 8px; font-size: 14px; }
    input, select, textarea {
      width: 100%; margin-top: 5px; padding: 6px;
      border-radius: 6px; border: none; outline: none;
    }
    textarea { min-height: 70px; resize: vertical; }
    .inline { display: flex; align-items: center; gap: 10px; margin-top: 8px; }
    button {
      margin-top: 10px; padding: 6px 12px;
      background: var(--red); border: none; border-radius: 6px;
      color: #fff; cursor: pointer; font-size: 14px;
    }
    button:hover { background: var(--red-dark); }
    .preview { margin-top: 8px; max-width: 100%; border-radius: 6px; }
    table { width: 100%; border-collapse: collapse; margin-top: 15px; font-size: 14px; }
    th, td { padding: 6px; border: 1px solid #333; text-align: left; }
    th { background: #222; }
    td img { max-width: 80px; border-radius: 4px; }
    tr.dragging { opacity: 0.5; background: #333; }

    /* Popup Modal */
    .modal {
      display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0,0,0,0.8); z-index: 1000; justify-content: center; align-items: center;
    }
    .modal-content {
      background: var(--bg-card); padding: 20px; border-radius: 10px;
      max-width: 700px; width: 90%; position: relative; color: var(--text-light);
    }
    .close { position: absolute; top: 10px; right: 15px; font-size: 20px; cursor: pointer; }
    .gallery { display: flex; align-items: center; justify-content: center; }
    .gallery img {
      max-width: 500px; max-height: 300px; border-radius: 6px;
    }
    .arrow {
      cursor: pointer; font-size: 28px; padding: 10px; color: var(--red);
      user-select: none;
    }
    .car-details { margin-top: 15px; font-size: 14px; }
    @media (max-width: 768px) {
      .flex-row { flex-direction: column; }
      .gallery img { max-width: 100%; }
    }
  </style>
</head>
<body>

  <h1>Admin Panel</h1>

  <!-- Car + Banner Side by Side -->
  <div class="flex-row">
    <!-- Car Management -->
    <div class="section">
      <h2>Add / Manage Cars</h2>
      <label>Category</label>
      <select id="carCategory">
        <option value="urgent">Urgent Sale</option>
        <option value="normal">Normal</option>
      </select>

      <label>Car Name</label><input type="text" id="carName">
      <label>Model</label><input type="text" id="carModel">
      <label>Specs</label><input type="text" id="carSpecs">
      <label>Color</label><input type="text" id="carColor">
      <label>Mileage</label><input type="text" id="carMileage">
      <label>Milkiya</label><input type="text" id="carMilkiya">
      <label>Accident History</label><input type="text" id="carAccident">

      <label>Price</label>
      <div class="inline">
        <input type="text" id="carPrice" placeholder="e.g. $25,000">
        <label><input type="checkbox" id="carNegotiable"> Negotiable</label>
      </div>

      <label>Ribbon (Editable)</label>
      <input type="text" id="carRibbon" placeholder="e.g. Hot Deal, Limited">

      <label>Details</label>
      <textarea id="carDetails" placeholder="Enter full car details..."></textarea>

      <label>Upload Car Images (Multiple)</label>
      <input type="file" id="carImages" accept="image/*" multiple>
      <div id="carImagePreview"></div>

      <button onclick="addCar()">Add Car</button>
    </div>

    <!-- Banner Management -->
    <div class="section">
      <h2>Manage Banners</h2>
      <label>Left Banner</label>
      <input type="file" id="leftBanner" accept="image/*">
      <img id="leftPreview" class="preview" style="display:none;" />

      <label>Right Banner</label>
      <input type="file" id="rightBanner" accept="image/*">
      <img id="rightPreview" class="preview" style="display:none;" />

      <label>Horizontal Banner</label>
      <input type="file" id="horizontalBanner" accept="image/*">
      <img id="horizontalPreview" class="preview" style="display:none;" />

      <button onclick="saveBanners()">Save Banners</button>

      <table id="bannerTable">
        <thead>
          <tr><th>Type</th><th>Preview</th><th>Actions</th></tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

  <!-- Car Table (full width below) -->
  <div class="section">
    <h2>Cars List</h2>
    <table id="carTable">
      <thead>
        <tr>
          <th>Image</th><th>Name</th><th>Model</th><th>Specs</th><th>Price</th><th>Actions</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <!-- Popup Modal -->
  <div id="carModal" class="modal">
    <div class="modal-content">
      <span class="close" onclick="closeModal()">&times;</span>
      <div class="gallery">
        <span class="arrow" onclick="prevImage()">&#10094;</span>
        <img id="modalImage" src="" alt="">
        <span class="arrow" onclick="nextImage()">&#10095;</span>
      </div>
      <div class="car-details" id="modalDetails"></div>
    </div>
  </div>

  <script>
   
  /* ---------------- Cars Management ---------------- */
  const carImagesInput = document.getElementById("carImages");
  const carImagePreview = document.getElementById("carImagePreview");

  let editIndex = null; // track editing

  carImagesInput.addEventListener("change", () => {
    carImagePreview.innerHTML = "";
    [...carImagesInput.files].forEach(file => {
      const reader = new FileReader();
      reader.onload = e => {
        const img = document.createElement("img");
        img.src = e.target.result;
        img.style.maxWidth = "80px";
        img.style.margin = "5px";
        img.style.borderRadius = "4px";
        carImagePreview.appendChild(img);
      };
      reader.readAsDataURL(file);
    });
  });

  function loadCars() {
    const cars = JSON.parse(localStorage.getItem("cars")) || [];
    const tbody = document.querySelector("#carTable tbody");
    tbody.innerHTML = "";
    cars.forEach((car, i) => {
      const row = document.createElement("tr");
      row.innerHTML = `
        <td>
          ${car.images && car.images.length > 0 
            ? `<img src="${car.images[0]}" alt="">` 
            : ""}
        </td>
        <td>${car.name}</td>
        <td>${car.model}</td>
        <td>${car.specs}</td>
        <td>${car.price} ${car.negotiable ? "(Negotiable)" : ""}</td>
        <td>
          <button onclick="editCar(${i})">Edit</button>
          <button onclick="deleteCar(${i})">Delete</button>
        </td>`;
      tbody.appendChild(row);
    });
  }

  function addCar() {
    const cars = JSON.parse(localStorage.getItem("cars")) || [];

    // Convert multiple uploaded images to base64
    function filesToBase64(files) {
      return Promise.all([...files].map(file => {
        return new Promise(resolve => {
          const reader = new FileReader();
          reader.onload = e => resolve(e.target.result);
          reader.readAsDataURL(file);
        });
      }));
    }

    filesToBase64(carImagesInput.files).then(images => {
      const newCar = {
        category: carCategory.value,
        name: carName.value,
        model: carModel.value,
        specs: carSpecs.value,
        color: carColor.value,
        mileage: carMileage.value,
        milkiya: carMilkiya.value,
        accident: carAccident.value,
        price: carPrice.value,
        negotiable: carNegotiable.checked,
        ribbon: carRibbon.value,
        details: carDetails.value,
        images: images.length > 0 ? images : (editIndex !== null ? cars[editIndex].images : [])
      };

      if (editIndex !== null) {
        cars[editIndex] = newCar;
        editIndex = null;
      } else {
        cars.push(newCar);
      }

      localStorage.setItem("cars", JSON.stringify(cars));
      loadCars();
      resetForm();
    });
  }

  function resetForm() {
    carName.value = "";
    carModel.value = "";
    carSpecs.value = "";
    carColor.value = "";
    carMileage.value = "";
    carMilkiya.value = "";
    carAccident.value = "";
    carPrice.value = "";
    carNegotiable.checked = false;
    carRibbon.value = "";
    carDetails.value = "";
    carImagesInput.value = "";
    carImagePreview.innerHTML = "";
  }

  function deleteCar(i) {
    const cars = JSON.parse(localStorage.getItem("cars")) || [];
    cars.splice(i, 1);
    localStorage.setItem("cars", JSON.stringify(cars));
    loadCars();
  }

  function editCar(i) {
    const cars = JSON.parse(localStorage.getItem("cars")) || [];
    const c = cars[i];
    carCategory.value = c.category;
    carName.value = c.name;
    carModel.value = c.model;
    carSpecs.value = c.specs;
    carColor.value = c.color;
    carMileage.value = c.mileage;
    carMilkiya.value = c.milkiya;
    carAccident.value = c.accident;
    carPrice.value = c.price;
    carNegotiable.checked = c.negotiable;
    carRibbon.value = c.ribbon;
    carDetails.value = c.details;
    editIndex = i; // set edit mode
  }

  document.addEventListener("DOMContentLoaded", () => {
    loadCars();
    renderBanners();
  });


    /* ---------------- Car Modal Gallery ---------------- */
    let currentCar = null;
    let currentImageIndex = 0;

    function viewCar(i) {
      const cars = JSON.parse(localStorage.getItem("cars")) || [];
      currentCar = cars[i];
      currentImageIndex = 0;
      document.getElementById("modalImage").src = currentCar.images[0] || "";
      document.getElementById("modalDetails").innerHTML = `
        <strong>${currentCar.name}</strong> (${currentCar.model})<br>
        Specs: ${currentCar.specs}<br>
        Color: ${currentCar.color}<br>
        Mileage: ${currentCar.mileage}<br>
        Milkiya: ${currentCar.milkiya}<br>
        Accident: ${currentCar.accident}<br>
        Price: ${currentCar.price} ${currentCar.negotiable ? "(Negotiable)" : ""}<br>
        Ribbon: ${currentCar.ribbon}<br>
        <p>${currentCar.details}</p>
      `;
      document.getElementById("carModal").style.display = "flex";
    }

    function closeModal() {
      document.getElementById("carModal").style.display = "none";
    }

    function prevImage() {
      if (!currentCar) return;
      currentImageIndex = (currentImageIndex - 1 + currentCar.images.length) % currentCar.images.length;
      document.getElementById("modalImage").src = currentCar.images[currentImageIndex];
    }

    function nextImage() {
      if (!currentCar) return;
      currentImageIndex = (currentImageIndex + 1) % currentCar.images.length;
      document.getElementById("modalImage").src = currentCar.images[currentImageIndex];
    }

    /* ---------------- Banner Management ---------------- */
    let banners = JSON.parse(localStorage.getItem("banners")) || {};

    function previewBanner(inputId, previewId, key) {
      const input = document.getElementById(inputId);
      const preview = document.getElementById(previewId);

      input.addEventListener("change", () => {
        const file = input.files[0];
        if (file) {
          const reader = new FileReader();
          reader.onload = e => {
            preview.src = e.target.result;
            preview.style.display = "block";
          };
          reader.readAsDataURL(file);
        }
      });

      if (banners[key]) {
        preview.src = banners[key];
        preview.style.display = "block";
      }
    }

    previewBanner("leftBanner", "leftPreview", "left");
    previewBanner("rightBanner", "rightPreview", "right");
    previewBanner("horizontalBanner", "horizontalPreview", "horizontal");

    function saveBanners() {
      const left = document.getElementById("leftBanner").files[0];
      const right = document.getElementById("rightBanner").files[0];
      const horizontal = document.getElementById("horizontalBanner").files[0];

      function fileToBase64(file, callback) {
        const reader = new FileReader();
        reader.onload = e => callback(e.target.result);
        reader.readAsDataURL(file);
      }

      if (left) {
        fileToBase64(left, data => {
          banners.left = data;
          localStorage.setItem("banners", JSON.stringify(banners));
          renderBanners();
          document.getElementById("leftPreview").src = data;
        });
      }
      if (right) {
        fileToBase64(right, data => {
          banners.right = data;
          localStorage.setItem("banners", JSON.stringify(banners));
          renderBanners();
          document.getElementById("rightPreview").src = data;
        });
      }
      if (horizontal) {
        fileToBase64(horizontal, data => {
          banners.horizontal = data;
          localStorage.setItem("banners", JSON.stringify(banners));
          renderBanners();
          document.getElementById("horizontalPreview").src = data;
        });
      }
    }

    function renderBanners() {
      const tbody = document.querySelector("#bannerTable tbody");
      tbody.innerHTML = "";
      for (const [key, src] of Object.entries(banners)) {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${key}</td>
          <td><img src="${src}" style="max-width:100px;border-radius:4px"></td>
          <td><button onclick="deleteBanner('${key}')">Delete</button></td>
        `;
        tbody.appendChild(tr);
      }
    }

    function deleteBanner(type) {
      delete banners[type];
      localStorage.setItem("banners", JSON.stringify(banners));
      renderBanners();
      if (type === "left") document.getElementById("leftPreview").style.display = "none";
      if (type === "right") document.getElementById("rightPreview").style.display = "none";
      if (type === "horizontal") document.getElementById("horizontalPreview").style.display = "none";
    }

    document.addEventListener("DOMContentLoaded", () => {
      loadCars();
      renderBanners();
    });
  </script>
</body>
</html>
